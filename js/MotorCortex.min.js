(function(E){E.MotroCortex=function(C){var F=!1;C&&(F=C.hasOwnProperty("debug")?C.debug:!1);var D=[],t=[],u=[],p=this,G=["duration","easing","delay","complete","loop"],H=function(a,d){var e=1*a,f=1*d;d<=a&&(p.log("warn","When using @rand make sure the first parameter is always smaller than the first one. Reverting and proceeding"),f=1*a,e=1*d);return e+(f-e)*Math.random()},w=function(a){return 0==a.indexOf("+=")?"+=":0==a.indexOf("-=")?"-=":0==a.indexOf("-")?"-":""},x=function(a){return-1!==a.indexOf(")px",
    a.length-3)?"px":-1!==a.indexOf("%",a.length-1)?"%":""},z=function(a){a=a.split(".")[1].split(")")[0];return-1!=a.indexOf("%")?a.substring(0,a.length-1):a};this.trigger=function(a,d,e,f){var n=!0,b,c,k,g;0===arguments.length?(p.log("error","You must always include the event name to be triggered when invoking the MotorCortex.trigger function, as the first parameter in string format"),b=new A(null),n=!1):"string"!=typeof arguments[0]?(p.log("error","The first argument of the trigger function should always be a string representing the name of the event to be triggered. "+
    typeof arguments[0]+" passed on call."),b=new A(null),n=!1):1<arguments.length&&("object"===typeof arguments[1]&&null!=arguments[1]?arguments[1].target?(c=arguments[1],2<arguments.length&&("object"===typeof arguments[2]&&null!=arguments[2]?(k=arguments[2],3<arguments.length&&("function"===typeof arguments[3]?g=arguments[3]:(p.log("error","Unrecognized type of 4th parameter on trigger function of event "+a+". Function expected, "+typeof arguments[3]+" passed."),n=!1))):"function"===typeof arguments[2]?
    g=arguments[2]:(p.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Object or Function expected, "+typeof arguments[2]+" passed."),n=!1))):(k=arguments[1],2<arguments.length&&("function"!=typeof arguments[2]?(p.log("error","Unrecognized type of 3rd parameter on trigger function of event "+a+". Function expected, "+typeof arguments[2]+" passed."),n=!1):g=arguments[2])):"function"===typeof arguments[1]?g=arguments[1]:(p.log("error","Unrecognized type of 2nd parameter on trigger function of event "+
    a+". Object or Function expected, "+typeof arguments[1]+" passed."),n=!1));k||(k={});g||(g=function(){});n&&(t.hasOwnProperty(a)?(b=new A(t[a]),t[a].fire(c,k,g)):(b=new A(null),p.log("error","The event with name "+a+" has not been defined in any of the MSS files. It will be ignored!")));return b};var A=function(a){this.stop=function(){a?a.stop():p.log("error","You tried to stop a process that has not been executed.")}},y=function(a,d,e,f,n){this.loops=1;f||(f={attributes:{},options:{}});n||(n="");
    this.selectionFunction=this.createSelectionFunction(a,n);a=new RegExp(/^@globals\.[a-zA-Z0-9\-\_]*$/);f=JSON.parse(JSON.stringify(f));f.attributes={};for(var b in d.attributes)a.exec(d.attributes[b])&&(n=d.attributes[b].split(".")[1].trim(),D.hasOwnProperty("@"+n)?d.attributes[b]=D["@"+n]:p.log("error","The global variable "+d.attributes[b]+" is not defined. It will be ignored")),0<=G.indexOf(b)?"loop"!==b?f.options[b]=d.attributes[b]:this.loops=d.attributes[b]:f.attributes[b]=d.attributes[b];var c=
        function(){e.CallbackHandler.animationEnded()};b=Object.keys(d.children);d.attributes.hasOwnProperty("loop")&&e.setLoopTimes(d.attributes.loop);for(a=0;a<b.length;a++){var k=b[a];if("complete:trigger"==k)c=function(a,b){t[d.children[k].attributes.eventName].fire(a,b,function(){e.CallbackHandler.animationEnded()})};else if("complete"!=k)e.addReadyThread(new y(this.selectionFunction,d.children[k],e,f,k));else{n=1;d.children[k].attributes.hasOwnProperty("loop")&&(n=d.children[k].attributes.loop);var g=
        new v(n);g.addReadyThread(new y(this.selectionFunction,d.children.complete,g,f));c=function(a,b){g.fire(a,b,function(){e.CallbackHandler.animationEnded()})}}}this.createAnimationFunction(f,c);this.execute=function(a,b){this.animationFunction(a,b,c)}};y.prototype.createAnimationFunction=function(a){var d=new RegExp(/^@params\.[a-zA-Z0-9\-\_]*$|^-@params\.[a-zA-Z0-9\-\_]*$|^-=@params\.[a-zA-Z0-9\-\_]*$|^\+=@params\.[a-zA-Z0-9\-\_]*$|^@params\.[a-zA-Z0-9\-\_]*.%$|-^@params\.[a-zA-Z0-9\-\_]*.%$|^-=@params\.[a-zA-Z0-9\-\_]*.%$|^\+=@params\.[a-zA-Z0-9\-\_]*.%$|^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|-^\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@params\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@params\.[a-zA-Z0-9\-\_]*.\)px$/),
    e=new RegExp(/^@domel\.[a-zA-Z0-9\-\_]*$|^-@domel\.[a-zA-Z0-9\-\_]*$|^-=@domel\.[a-zA-Z0-9\-\_]*$|^\+=@domel\.[a-zA-Z0-9\-\_]*$|^@domel\.[a-zA-Z0-9\-\_]*.%$|^-@domel\.[a-zA-Z0-9\-\_]*.%$|^-=@domel\.[a-zA-Z0-9\-\_]*.%$|^\+=@domel\.[a-zA-Z0-9\-\_]*.%$|^\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^-=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$|^\+=\(@domel\.[a-zA-Z0-9\-\_]*.\)px$/),f=new RegExp(/^@rand\( *?.+ *?, *?.+ *?\)$|^-@rand\( *?.+ *?, *?.+ *?\)$|^-=@rand\( *?.+ *?, *?.+ *?\)$|^\+=@rand\( *?.+ *?, *?.+ *?\)$|^@rand\( *?.+ *?, *?.+ *?\)%$|^-@rand\( *?.+ *?, *?.+ *?\)%$|^-=@rand\( *?.+ *?, *?.+ *?\)%$|^\+=@rand\( *?.+ *?, *?.+ *?\)%$|^@rand\( *?.+ *?, *?.+ *?\)px$|^-@rand\( *?.+ *?, *?.+ *?\)px$|^-=@rand\( *?.+ *?, *?.+ *?\)px$|^\+=@rand\( *?.+ *?, *?.+ *?\)px$/),
    n=!1;a.options.hasOwnProperty("duration")||(a.options.duration="0.3s",n=!0);this.animationFunction=function(b,c,k){var g=!1,q=!1,l=[],r=[],m=0,B=[],t=function(a){for(var r=0;r<B.length;r++)B[r](a);return a},h;for(h in a.attributes)if("-."==h){var u=a.attributes[h]+"";B.push(function(a){a.removeClass(u)})}else if("+."==h)u=a.attributes[h]+"",B.push(function(a){a.addClass(u)});else if(m+=1,d.exec(a.attributes[h])){var s=z(a.attributes[h]);c.hasOwnProperty(s)?a.attributes[h]=w(a.attributes[h])+c[s]+
    x(a.attributes[h]):p.log("error","The variable "+s+" was expected in the params object but is not present. It will be ignored")}else e.exec(a.attributes[h])?(l.push({pre:w(a.attributes[h]),units:x(a.attributes[h]),whichPart:"attributes",whichKey:h,byWhichAttr:z(a.attributes[h])}),g=!0):f.exec(a.attributes[h])&&(s=a.attributes[h].match(/([^()]+)/g)[1].split(","),r.push({pre:w(a.attributes[h]),units:x(a.attributes[h]),whichPart:"attributes",whichKey:h,byWhichRand:[1*s[0].trim(),1*s[1].trim()]}));for(h in a.options)d.exec(a.options[h])?
    (s=z(a.options[h]),c.hasOwnProperty(s)?a.options[h]=w(a.options[h])+c[s]+x(a.options[h]):p.log("error","The variable "+s+" was expected in the params object but is not present. It will be ignored")):e.exec(a.options[h])?(l.push({pre:w(a.options[h]),units:x(a.options[h]),whichPart:"options",whichKey:h,byWhichAttr:z(a.options[h])}),g=!0):f.exec(a.options[h])&&(q=!0,s=a.options[h].match(/([^()]+)/g)[1].split(","),r.push({pre:w(a.options[h]),units:x(a.options[h]),whichPart:"options",whichKey:h,byWhichRand:[1*
    s[0].trim(),1*s[1].trim()]}));if(0==m)return t(this.selectionFunction(a,b)),k(b,c),!0;n&&p.log("error","The duration has not been defined. The default (0.3s) will be used");if(g||q){var g=this.selectionFunction(a,b),v={numberOfElements:g.length,numberOfFinished:0,finished:function(){this.numberOfFinished+=1;this.numberOfFinished==this.numberOfElements&&k(b,c)}};g.each(function(){for(var b=JSON.parse(JSON.stringify(a)),m=0;m<l.length;m++)b[l[m].whichPart][l[m].whichKey]=l[m].pre+$(this).attr(l[m].byWhichAttr)+
    l[m].units;for(m=0;m<r.length;m++)b[r[m].whichPart][r[m].whichKey]=r[m].pre+H(r[m].byWhichRand[0],r[m].byWhichRand[1])+r[m].units;b.options.complete=function(){v.finished()};t($(this)).velocity(b.attributes,b.options)})}else a.options.complete=function(){k(b,c)},this.selectionFunction(a,b),t(this.selectionFunction(a,b)).velocity(a.attributes,a.options)}};y.prototype.createSelectionFunction=function(a,d){var e=[{name:"index greater than",rxp:new RegExp(/^@index\ *?\>\ *?\d+$/),createSelectionFunction:function(a){return function(m){return":gt("+
    a.split(":")[1].trim()+")"}}},{name:"index less than",rxp:new RegExp(/^@index\ *?\<\ *?\d+$/),createSelectionFunction:function(a){return function(m){return":lt("+a.split(":")[1].trim()+")"}}},{name:"index less or equal to",rxp:new RegExp(/^@index\ *?\<\=\ *?\d+$/),createSelectionFunction:function(a){return function(m){return":lt("+a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},{name:"index greater or equal to",rxp:new RegExp(/^@index\ *?\>\=\ *?\d+$/),createSelectionFunction:function(a){return function(m){return":gt("+
    a.split(":")[1].trim()+"):eq"+a.split(":")[1].trim()+")"}}},{name:"index equals to",rxp:new RegExp(/^@index\ *?\={2}\ *?\d+$/),createSelectionFunction:function(a){return function(m){return":eq("+a.split(":")[1].trim()+")"}}},{name:"index odd",rxp:new RegExp(/^@index *?odd$/),createSelectionFunction:function(a){return function(a){return":odd"}}},{name:"index even",rxp:new RegExp(/^@index *?even$/),createSelectionFunction:function(a){return function(a){return":even"}}},{name:"index greater than parameter",
    rxp:new RegExp(/^@index\ *?\>\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(m){var b=a.split(":")[1].trim().split(".")[1];if(m.hasOwnProperty(b))return":gt("+m[b]+")";p.log("error","The expected params key "+b+" is not present. The selector will be ignored!");return""}}},{name:"index less than parameter",rxp:new RegExp(/^@index\ *?\<\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var c=a.split(":")[1].trim().split(".")[1];
    if(b.hasOwnProperty(c))return":lt("+b[c]+")";p.log("error","The expected params key "+c+" is not present. The selector will be ignored!");return""}}},{name:"index less or equal to parameter",rxp:new RegExp(/^@index\ *?\<\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var c=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(c))return":lt("+b[c]+"):eq"+b[c]+")";p.log("error","The expected params key "+c+" is not present. The selector will be ignored!");
    return""}}},{name:"index greater or equal to parameter",rxp:new RegExp(/^@index\ *?\>\=\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var c=a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(c))return":gt("+b[c]+"):eq"+b[c]+")";p.log("error","The expected params key "+c+" is not present. The selector will be ignored!");return""}}},{name:"index greater than parameter",rxp:new RegExp(/^@index\ *?\={2}\ *\@params. ?[a-zA-Z0-9\.\-\_]+$/),createSelectionFunction:function(a){return function(b){var c=
    a.split(":")[1].trim().split(".")[1];if(b.hasOwnProperty(c))return":eq("+b[c]+")";p.log("error","The expected params key "+c+" is not present. The selector will be ignored!");return""}}}],f=function(a){return function(b){return a}};if("[object Array]"===Object.prototype.toString.call(a)){for(var n=a.length,b=[],c,k=!1,g=0;g<n-1;g++)if(0!=a[g].indexOf("@"))"triggeringElement"==a[g]?k?p.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):
    (c=function(a){if(a)return $(a.target);p.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");return $("*")},k=!0):"not(triggeringElement)"==a[g].replace(/ +?/g,"")?k?p.log("warn","The triggering object filter seems to have been applied twice. The second directive will be ignored!"):(c=function(a){if(a)return $("*").not($(a.target));p.log("error","You have included the 'triggeringElement' directive in your selection string on MSS, though you didn't pass the event object on the trigger function. The directive will be ignored");
    return $("*")},k=!0):b.push(f(a[g]));else{for(var q=!1,l=0;l<e.length;l++)if(e[l].rxp.exec(a[g])){b.push(e[l].createSelectionFunction(a[g]));q=!0;break}q||p.log("error","The selection "+a[g]+" seems to be invalid. It will be ignored!")}return function(a,m){for(var f="",e=0;e<b.length;e++)f+=b[e](a);f=c?c(m).filter(f):$(f);return""==d?f:f.find(d)}}return function(b,c){return""==d?a(b,c):a(b,c).find(d)}};var v=function(a,d){a||(a=1);this.threads=[];this.addTheThread=function(a,d){this.threads.push(new y(a,
    d,this))};this.addReadyThread=function(a){this.threads.push(a)};var e=this;this.CallbackHandler={numberOfExecutedLeafs:0,numberOfLoopsCompleted:0,eventId:d,init:function(a,d,b,c){this.numberOfThreads=a;this.callbackFunction=d;this.e=b;this.options=c;return this},setLoopTimes:function(d){a=d},reset:function(a){if(!a)return this.resetLoop(),this.numberOfLoopsCompleted=0,this},resetLoop:function(){this.numberOfExecutedLeafs=0},animationEnded:function(){this.numberOfExecutedLeafs+=1;if(this.numberOfExecutedLeafs==
    this.numberOfThreads)if(this.numberOfLoopsCompleted+=1,this.numberOfLoopsCompleted==a){if(null!=this.eventId&&null!=u[this.eventId]&&void 0!=u[this.eventId]){if("string"==typeof u[this.eventId])t[u[this.eventId]].fire(this.e,this.options,this.callbackFunction);else if(Array.isArray(u[this.eventId]))for(var d=0;d<u[this.eventId].length;d++)t[u[this.eventId][d]].fire(this.e,this.options,this.callbackFunction);return!0}this.callbackFunction()}else this.resetLoop(),e.fire(this.e,this.options,this.callbackFunction,
    !0)}}};v.prototype.setOverallEventCallback=function(a){this.parentEvent.setOverallEventCallback()};v.prototype.addThread=function(a,d){this.addTheThread(a,d)};v.prototype.fire=function(a,d,e,f){e||(e=function(){});d||(d={});this.CallbackHandler.init(this.threads.length,e,a,d,this.fire).reset(f);for(e=0;e<this.threads.length;e++)this.threads[e].execute(a,d)};v.prototype.stop=function(){};v.prototype.setLoopTimes=function(a){this.CallbackHandler.setLoopTimes(a)};var I=new function(){var a=this;a.init=
    function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.repeat=function(a){return Array(1+a).join(this)}};a.init();var d=/([^\:]+):([^\;]*);/,e=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gmi,f=function(a){return"undefined"==typeof a||0==a.length||null==a};a.toJSON=function(n){for(var b={children:{},attributes:{}},c=null,k=0,g={ordered:!1,comments:!1,stripComments:!1,split:!1};null!=(c=e.exec(n));)if(!f(c[1])&&g.comments)c=
    c[1].trim(),b[k++]=c;else if(f(c[2]))if(f(c[3]))f(c[4])||(c=c[4].trim(),(q=d.exec(c))?(c=q[1].trim(),q=q[2].trim(),g.ordered?(l={},l.name=c,l.value=q,l.type="attr",b[k++]=l):c in b.attributes?(l=b.attributes[c],l instanceof Array||(b.attributes[c]=[l]),b.attributes[c].push(q)):b.attributes[c]=q):b[k++]=c);else break;else{var c=c[2].trim(),q=a.toJSON(n,g);if(g.ordered){var l={};l.name=c;l.value=q;l.type="rule";b[k++]=l}else for(i in c=g.split?c.split(","):[c],c)if(l=c[i].trim(),l in b.children)for(var r in q.attributes)b.children[l].attributes[r]=
    q.attributes[r];else b.children[l]=q}return b}};this.log=function(a,d,e){F&&(d="MotorCortex "+a+": "+d,e&&(console.log(e),d+=" | "+e),console[a](d))};this.loadMSS=function(a,d){var e,f,n=this;if(!E.jQuery)return this.log("error","jQuery has not been loaded. Please load jQuery before MotorCortex.loadMSS invocation"),this.execute=function(){this.log("error","jQuery has not been loaded")},!1;var b;if("[object Array]"!=Object.prototype.toString.call(a))if("string"===typeof a)b=[a];else return this.log("error",
    "Unidentified / Unsupported files attribute type. Currently supported only array and string"),!1;else b=a;var c=b.length;e=0;f=function(){e+=1;e===c&&d()};for(var k=0;k<c;k++){var g=b[k];$.ajax({url:g,type:"GET",async:!0,success:function(a){a=I.toJSON(a);var b=new RegExp(/^[a-zA-Z0-9\.\-\_]+\:callback$/),c=new RegExp(/^@[a-zA-Z0-9\.\-\_]*?/),d;for(d in a.attributes)a.attributes.hasOwnProperty(d)&&("@index"==d||"@params"==d||"@domel"==d?p.log("warn","The keywords/parameter names @index, @params and @domel are reserved by MotorCortex and cannot be used as a global variable's name. The declared global "+
    d+" will be ignored!"):c.exec(d)?D[d]=a.attributes[d]:p.log("warn","The property "+d+" should begin with the character '@'. It will be ignored!"));for(d in a.children)if(b.exec(d)&&(c=d.split(":"),u[c[0]]=a.children[d].attributes.eventName),c=d.split(":"),2>c.length)p.log("error","The MC selection and event part "+d+" is not valid. Each MC selection string should consist by least a selection string and an event name separated by the ':' character.");else if(t.hasOwnProperty(c[c.length-1]))e.addThread(c,
    a.children[d]);else{e=1;a.children[d].attributes.hasOwnProperty("loop")&&(e=a.children[d].attributes.loop);var e=new v(e,c[c.length-1]);e.addThread(c,a.children[d]);t[c[c.length-1]]=e}f()},error:function(a,b,c){n.log("error","The MSS file "+g+" seems to be missing",c)}})}}}})(window);